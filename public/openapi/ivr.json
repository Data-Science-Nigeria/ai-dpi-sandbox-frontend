{
  "openapi": "3.0.3",
  "info": {
    "title": "IVR Service",
    "description": "Interactive Voice Response (IVR) service for Nigerian phone numbers",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:8004",
      "description": "IVR Service"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "CallRequest": {
        "type": "object",
        "required": ["to", "message"],
        "properties": {
          "to": {
            "type": "string",
            "pattern": "^\\+234[0-9]{10}$|^0[0-9]{10}$",
            "example": "+2348012345678",
            "description": "Nigerian phone number"
          },
          "message": {
            "type": "string",
            "example": "Hello, your account balance is 5000 Naira. Press 1 for more options."
          },
          "voice": {
            "type": "string",
            "enum": ["male", "female"],
            "default": "female",
            "example": "female"
          },
          "language": {
            "type": "string",
            "enum": ["en", "ha", "ig", "yo"],
            "default": "en",
            "example": "en",
            "description": "Language code (en=English, ha=Hausa, ig=Igbo, yo=Yoruba)"
          }
        }
      },
      "MenuConfiguration": {
        "type": "object",
        "properties": {
          "menu_id": {
            "type": "string",
            "example": "main_menu"
          },
          "title": {
            "type": "string",
            "example": "Main Menu"
          },
          "options": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "key": {
                  "type": "string",
                  "example": "1"
                },
                "text": {
                  "type": "string",
                  "example": "Check Balance"
                },
                "action": {
                  "type": "string",
                  "example": "balance_check"
                }
              }
            }
          }
        }
      },
      "CallResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "call_id": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["initiated", "ringing", "answered", "completed", "failed"]
          },
          "message": {
            "type": "string"
          },
          "duration": {
            "type": "integer",
            "description": "Call duration in seconds"
          }
        }
      }
    }
  },
  "paths": {
    "/api/v1/call": {
      "post": {
        "tags": ["IVR"],
        "summary": "Initiate IVR call",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CallRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "IVR call initiated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CallResponse"
                },
                "example": {
                  "success": true,
                  "call_id": "call_12345",
                  "status": "initiated",
                  "message": "IVR call initiated successfully",
                  "duration": 0
                }
              }
            }
          },
          "400": {
            "description": "Invalid phone number or parameters"
          },
          "500": {
            "description": "IVR service error"
          }
        }
      }
    },
    "/api/v1/menu": {
      "get": {
        "tags": ["IVR"],
        "summary": "Get IVR menu configuration",
        "parameters": [
          {
            "name": "menu_id",
            "in": "query",
            "schema": {
              "type": "string",
              "example": "main_menu"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "IVR menu configuration",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MenuConfiguration"
                },
                "example": {
                  "menu_id": "main_menu",
                  "title": "Main Menu",
                  "options": [
                    {
                      "key": "1",
                      "text": "Check Balance",
                      "action": "balance_check"
                    },
                    {
                      "key": "2",
                      "text": "Transfer Money",
                      "action": "transfer"
                    },
                    {
                      "key": "0",
                      "text": "Speak to Agent",
                      "action": "agent_transfer"
                    }
                  ]
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["IVR"],
        "summary": "Create or update IVR menu configuration",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MenuConfiguration"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Menu configuration updated",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "message": "Menu configuration updated successfully"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/call/{call_id}/status": {
      "get": {
        "tags": ["IVR"],
        "summary": "Get call status",
        "parameters": [
          {
            "name": "call_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "example": "call_12345"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Call status",
            "content": {
              "application/json": {
                "example": {
                  "call_id": "call_12345",
                  "status": "completed",
                  "duration": 45,
                  "phone": "+2348012345678",
                  "completed_at": "2024-01-15T10:30:00Z"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": ["System"],
        "summary": "Health check endpoint",
        "security": [],
        "responses": {
          "200": {
            "description": "Service health status",
            "content": {
              "application/json": {
                "example": {
                  "status": "healthy",
                  "service": "ivr-service"
                }
              }
            }
          }
        }
      }
    }
  }
}